<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ“š Ù…ÙƒØªØ¨Ø© Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø®Ù„ÙŠÙ„</title>
  <style>
    :root { --card:#ffffff; --muted:#f6f7fb; --text:#243042; --primary:#1e88e5; --ok:#28a745; --danger:#e53935; }
    body{
      font-family: "Tajawal", Arial, sans-serif;
      margin:0; padding:0; background:#eef1f6;
      background-image:linear-gradient(180deg,#eef1f6 0%, #e6ecf8 100%);
    }
    .wrap{max-width:980px;margin:24px auto;padding:16px;}
    .card{
      background:var(--card); border-radius:16px; box-shadow:0 8px 20px rgba(0,0,0,.08);
      padding:22px 18px;
    }
    header{
      text-align:center; margin-bottom:14px;
    }
    header img{height:80px; display:block; margin:8px auto 6px;}
    header h1{margin:6px 0 0; color:var(--text); font-size:28px}
    label.top{display:block; margin:12px 0 6px; font-weight:700; color:var(--text); font-size:18px}
    input[type="text"], select{
      width:100%; padding:12px 14px; border:1px solid #cfd6e4; border-radius:10px; font-size:18px; background:#fff;
    }
    .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:14px}
    @media (max-width:720px){ .grid-2{grid-template-columns:1fr} }

    /* Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙƒØªØ¨ */
    .book-group{
      background:var(--muted); border:1px solid #e6e9f0; padding:14px; border-radius:12px; margin-top:14px;
    }
    .group-head{
      display:grid; grid-template-columns: auto 220px; gap:10px; align-items:center; margin-bottom:10px;
    }
    .group-head .title{font-weight:700; color:var(--text); font-size:18px}
    .stage-select{font-size:18px}
    .subjects{
      display:grid; grid-template-columns: repeat(3, 1fr); gap:12px;
    }
    @media (max-width:880px){ .subjects{grid-template-columns: repeat(2, 1fr);} }
    @media (max-width:620px){ .subjects{grid-template-columns: 1fr;} }

    .subject-item{
      display:grid; grid-template-columns: 28px 1fr 130px; gap:6px; align-items:center;
      background:#fff; padding:6px 8px; border-radius:10px; border:1px solid #e6e9f0; font-size:18px;
    }
    .subject-item input[type="text"]{
      width:100%; padding:6px 8px; height:34px; font-size:16px; display:none; border:1px solid #cfd6e4; border-radius:8px;
    }
    .subject-item label{margin:0; white-space:nowrap}

    .actions{display:flex; gap:10px; margin-top:16px; flex-wrap:wrap}
    button{
      border:none; border-radius:10px; padding:12px 16px; font-size:18px; cursor:pointer;
    }
    .btn-add{background:var(--primary); color:#fff}
    .btn-save{background:var(--ok); color:#fff; flex:1}
    .btn-remove{background:#fff; color:var(--danger); border:1px solid #f2b6b6}

    .error{border-color:var(--danger)!important; box-shadow:0 0 0 2px rgba(229,57,53,.12)}
    .hint{font-size:14px; color:#6b7a90; margin-top:4px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <header>
        <img src="school-logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©">
        <h1>ğŸ“š Ù…ÙƒØªØ¨Ø© Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø®Ù„ÙŠÙ„</h1>
            <h2> -- Ù†Ù…ÙˆØ°Ø¬ Ø·Ù„Ø¨ ÙƒØªØ¨ Ø®Ø§Ø±Ø¬ÙŠØ© Ù…Ù† Ø§Ù„Ù…Ø¯Ø±Ø³Ø© -- </h2>
      </header>

      <form id="orderForm" novalidate>
        <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
        <div class="grid-2">
          <div>
            <label class="top" for="fullName">Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ</label>
            <input id="fullName" name="fullName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ" required>
          </div>
          <div>
            <label class="top" for="section">Ø§Ù„Ù‚Ø³Ù…</label>
            <input id="section" name="section" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©/ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª / Ø§Ø¯Ø§Ø±ÙŠ / Ø§Ø´Ø±Ø§Ù ..." required>
          </div>
        </div>
        <div class="hint">* Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù‚Ø³Ù… Ø­Ù‚ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©.</div>

        <!-- Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø§Ù„ÙƒØªØ¨ -->
        <div id="booksContainer"></div>

        <div class="actions">
          <button type="button" class="btn-add" id="btnAdd">â• Ø£Ø¶Ù ÙƒØªØ§Ø¨ Ø¢Ø®Ø±</button>
          <button type="submit" class="btn-save">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Ù‚Ø§Ù„Ø¨ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„ÙƒØªØ¨ -->
  <template id="groupTemplate">
    <div class="book-group">
      <div class="group-head">
        <div class="title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©</div>
        <select class="stage-select">
          <option value="">â€” Ø§Ø®ØªØ± Ø§Ù„Ù…Ø±Ø­Ù„Ø© â€”</option>
          <option>Ø§Ù„Ø£ÙˆÙ„ Ø±ÙŠØ§Ø¶ Ø£Ø·ÙØ§Ù„</option>
          <option>Ø§Ù„Ø«Ø§Ù†ÙŠ Ø±ÙŠØ§Ø¶ Ø£Ø·ÙØ§Ù„</option>
          <option>Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
          <option>Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
          <option>Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
          <option>Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
          <option>Ø§Ù„Ø®Ø§Ù…Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
          <option>Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ</option>
          <option>Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option>
          <option>Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option>
          <option>Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠ</option>
          <option>Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
          <option>Ø§Ù„Ø«Ø§Ù†ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
          <option>Ø§Ù„Ø«Ø§Ù„Ø« Ø§Ù„Ø«Ø§Ù†ÙˆÙŠ</option>
        </select>
      </div>

      <div class="subjects">
        <!-- 11 Ù…Ø§Ø¯Ø© -->
        <div class="subject-item"><input type="checkbox" /><label>Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</label><input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨"></div>
        <div class="subject-item"><input type="checkbox" /><label>Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</label><input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨"></div>
        <div class="subject-item"><input type="checkbox" /><label>Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</label><input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨"></div>
        <div class="subject-item"><input type="checkbox" /><label>Ø§Ù„Ø¹Ù„ÙˆÙ…</label><input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨"></div>
        <div class="subject-item"><input type="checkbox" /><label>Ø§Ù„Ø¯Ø±Ø§Ø³Ø§Øª</label><input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨"></div>
        <div class="subject-item"><input type="checkbox" /><label>Ø§Ù„ÙÙŠØ²ÙŠØ§Ø¡</label><input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨"></div>
        <div class="subject-item"><input type="checkbox" /><label>Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡</label><input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨"></div>
        <div class="subject-item"><input type="checkbox" /><label>Ø§Ù„Ø£Ø­ÙŠØ§Ø¡</label><input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨"></div>
        <div class="subject-item"><input type="checkbox" /><label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨"></div>
        <div class="subject-item"><input type="checkbox" /><label>Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ§</label><input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨"></div>
        <div class="subject-item"><input type="checkbox" /><label>Ø§Ù„ÙÙ„Ø³ÙØ©</label><input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨"></div>
        <div class="subject-item"><input type="checkbox" /><label>Ø§Ø®Ø±Ù‰</label><input type="text" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨"></div>
      </div>

      <div class="actions">
        <button type="button" class="btn-remove">ğŸ—‘ï¸   </button>
      </div>
    </div>
  </template>

  <script>
    const container = document.getElementById('booksContainer');
    const btnAdd = document.getElementById('btnAdd');
    const template = document.getElementById('groupTemplate');
    const form = document.getElementById('orderForm');

    // Ø±Ø§Ø¨Ø· Google Apps Script (Ø§Ø³ØªØ¨Ø¯Ù„Ù‡ Ø¨Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆÙŠØ¨ Ø¢Ø¨ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ)
   const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwtXW44TtkpttTMdazJVbs1YxND9uolnqwxDmPm6xHI8x0wD47oxHQQi7-rSe8CK3xK/exec";


    // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø£ÙˆÙ„Ù‰ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    addGroup();

    // Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø©
    btnAdd.addEventListener('click', addGroup);

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø¬Ù…ÙˆØ¹Ø©
    function addGroup(){
      const clone = template.content.cloneNode(true);
      wireGroup(clone.querySelector('.book-group'));
      container.appendChild(clone);
    }

    // Ø±Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¯Ø®Ù„ Ø§Ù„Ù†Øµ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± + Ø­Ø°Ù)
    function wireGroup(groupEl){
      // ÙƒØ´Ù/Ø¥Ø®ÙØ§Ø¡ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù†Øµ
      groupEl.querySelectorAll('.subject-item').forEach(item=>{
        const cb = item.querySelector('input[type="checkbox"]');
        const txt = item.querySelector('input[type="text"]');
        cb.checked = false; txt.value=''; txt.style.display='none';
        cb.addEventListener('change', ()=>{ txt.style.display = cb.checked ? 'block' : 'none'; });
      });
      // Ø­Ø°Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©
      groupEl.querySelector('.btn-remove').addEventListener('click', ()=>{
        if(document.querySelectorAll('.book-group').length>1){
          groupEl.remove();
        }else{
          groupEl.querySelector('.stage-select').value = '';
          groupEl.querySelectorAll('.subject-item input[type="checkbox"]').forEach(cb=>cb.checked=false);
          groupEl.querySelectorAll('.subject-item input[type="text"]').forEach(t=>{t.value=''; t.style.display='none';});
        }
      });
    }

    // Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨
    form.addEventListener('submit', (e)=>{
      e.preventDefault();

      const name = document.getElementById('fullName');
      const section = document.getElementById('section');
      [name, section].forEach(el=>el.classList.remove('error'));

      if(!name.value.trim()){ name.classList.add('error'); name.focus(); return; }
      if(!section.value.trim()){ section.classList.add('error'); section.focus(); return; }

      const entries = [];
      let stageMissing = false;

      document.querySelectorAll('.book-group').forEach(group=>{
        const stageSel = group.querySelector('.stage-select');
        const stage = stageSel.value.trim();
        const picksInGroup = [];

        group.querySelectorAll('.subject-item').forEach(item=>{
          const cb = item.querySelector('input[type="checkbox"]');
          const label = item.querySelector('label').textContent.trim();
          const title = item.querySelector('input[type="text"]').value.trim();
          if(cb.checked){
            picksInGroup.push({subject: label, bookTitle: title || ''});
          }
        });

        if(picksInGroup.length && !stage){
          stageMissing = true;
          stageSel.classList.add('error');
          stageSel.scrollIntoView({behavior:'smooth', block:'center'});
        }else{
          stageSel.classList.remove('error');
        }

        picksInGroup.forEach(p=>entries.push({stage, subject:p.subject, bookTitle:p.bookTitle}));
      });

      if(stageMissing){
        alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± "Ø§Ù„Ù…Ø±Ø­Ù„Ø©" Ù„ÙƒÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ù‚Ù…Øª Ø¨Ø§Ø®ØªÙŠØ§Ø± Ù…ÙˆØ§Ø¯ Ø¨Ø¯Ø§Ø®Ù„Ù‡Ø§.');
        return;
      }
      if(entries.length===0){
        alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ù…Ø§Ø¯Ø© ÙˆØ§Ø­Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.');
        return;
      }

      const payload = {
        fullName: name.value.trim(),
        section: section.value.trim(),
        timestamp: new Date().toISOString(),
        items: entries
      };

      fetch(SCRIPT_URL, {
        method: 'POST',
        body: JSON.stringify(payload),
        headers: { 'Content-Type': 'application/json' }
      })
      .then(res => res.json())
      .then(response => {
        if(response.result === "success"){
          alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­");
          form.reset();
          container.innerHTML = "";
          addGroup(); // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙØ§Ø±ØºØ©
        } else {
          alert("âŒ Ø®Ø·Ø£: " + response.message);
        }
      })
      .catch(err => {
        alert("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Google Sheets");
        console.error(err);
      });
    });
  </script>
</body>
</html>





